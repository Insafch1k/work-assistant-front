<div class="admin-panel-container">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="admin-header">
    <button class="back-btn" (click)="goBack()">
      –ù–∞–∑–∞–¥
    </button>
    <h1>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1>
  </div>

  <!-- –ë–ª–æ–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ -->
  <div class="metrics-section">
    <div class="section-header" (click)="toggleMetrics()">
      <h2>üìä –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏</h2>
      <span class="arrow" [class.rotated]="metricsExpanded">‚ñº</span>
    </div>
    
    <div class="metrics-content" [class.expanded]="metricsExpanded" *ngIf="metrics">
      <div class="period-select">
        <label>–ü–µ—Ä–∏–æ–¥: </label>
        <select [ngModel]="selectedWindow" (ngModelChange)="onWindowChange($event)">
          <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
          <option value="yesterday">–í—á–µ—Ä–∞</option>
          <option value="7d">–ó–∞ 7 –¥–Ω–µ–π</option>
          <option value="30d">–ó–∞ 30 –¥–Ω–µ–π</option>
        </select>
      </div>
      
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">üôÇ</div>
          <div class="metric-content">
            <h3>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <p class="metric-value">{{ formatNumber(metrics.registeredUsers || 0) }}</p>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">‚ö°</div>
          <div class="metric-content">
            <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <p class="metric-value">{{ formatNumber(metrics.activeUsers || 0) }}</p>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">üìù</div>
          <div class="metric-content">
            <h3>–ù–æ–≤—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h3>
            <p class="metric-value">{{ formatNumber(metrics.newVacancies || 0) }}</p>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">üì§</div>
          <div class="metric-content">
            <h3>–û—Ç–∫–ª–∏–∫–∏</h3>
            <p class="metric-value">{{ formatNumber(metrics.responsesCount || 0) }}</p>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-icon">üìà</div>
          <div class="metric-content">
            <h3>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ—Ç–∫–ª–∏–∫–æ–≤</h3>
            <p class="metric-value">{{ (metrics.responseRate || 0).toFixed(2) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ë–ª–æ–∫ –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div class="moderation-section">
    <div class="section-header" (click)="toggleModeration()">
      <h2>üõ°Ô∏è –ú–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
      <span class="arrow" [class.rotated]="moderationExpanded">‚ñº</span>
    </div>
    
    <div class="users-block" *ngIf="moderationExpanded">
      <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
      
      <div class="search-container">
        <input 
          type="text" 
          placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
          [(ngModel)]="userSearchTerm"
          (keyup.enter)="onUserSearch()">
        <button (click)="onUserSearch()">üîç</button>
      </div>

      <div class="users-list" *ngIf="!usersLoading">
        <div class="user-card" *ngFor="let user of users">
          <div class="user-info">
            <h4>{{ user.name }}</h4>
            <p>{{ user.role === 'employer' ? '–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å' : '–°–æ–∏—Å–∫–∞—Ç–µ–ª—å' }}</p>
            <small>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {{ user.registration_date | date:'dd.MM.yyyy' }}</small>
            <span class="status" [class.banned]="user.status === 'banned'">
              {{ user.status === 'banned' ? '–ó–∞–±–∞–Ω–µ–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω' }}
            </span>
          </div>
          <button 
            class="action-btn" 
            [class.ban]="user.status === 'active'"
            [class.unban]="user.status === 'banned'"
            (click)="user.status === 'active' ? banUser(user) : unbanUser(user)">
            {{ user.status === 'active' ? 'üö´' : '‚úÖ' }}
          </button>
        </div>
      </div>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
      <div class="pagination" *ngIf="totalUserPages > 1">
        <button 
          (click)="loadUsers(currentUserPage - 1)"
          [disabled]="currentUserPage === 1">
          ‚Üê
        </button>
        
        <span 
          *ngFor="let page of getUserPages()"
          class="page-number"
          [class.active]="page === currentUserPage"
          (click)="loadUsers(page)">
          {{ page }}
        </span>
        
        <button 
          (click)="loadUsers(currentUserPage + 1)"
          [disabled]="currentUserPage === totalUserPages">
          ‚Üí
        </button>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="closeDeleteConfirm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
    <p>
      –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ 
      <span *ngIf="itemToDelete?.type === 'user'">–∑–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
      <span *ngIf="itemToDelete?.type === 'vacancy'">—É–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</span>
      <strong>"{{ itemToDelete?.name }}"</strong>?
    </p>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="closeDeleteConfirm()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn-confirm" (click)="confirmDelete()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>
  </div>
</div>